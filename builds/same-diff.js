const t=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});const n=-1;function e(t,n){return[t,n]}function s(b,p,m,d=!0,x){const A=function(n){if(n?.__resolved)return n;const e={...t,...n};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}(m);void 0===x&&(x=A.diffTimeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*A.diffTimeout);const w=x;if(null==b||null==p)throw new Error("Null input. (diff_main)");if(b===p)return b?[e(0,b)]:[];const M=d;let y=l(b,p);const _=b.substring(0,y);y=i(b=b.substring(y),p=p.substring(y));const O=b.substring(b.length-y),v=function(t,b,p,m,d){let x;if(!t)return[e(1,b)];if(!b)return[e(n,t)];const A=t.length>b.length?t:b,w=t.length>b.length?b:t,M=A.indexOf(w);if(-1!==M)return x=[e(1,A.substring(0,M)),e(0,w),e(1,A.substring(M+w.length))],t.length>b.length&&(x[0][0]=x[2][0]=n),x;if(1===w.length)return[e(n,t),e(1,b)];const y=function(t,n,e){if(e.diffTimeout<=0)return null;const s=t.length>n.length?t:n,r=t.length>n.length?n:t;if(s.length<4||2*r.length<s.length)return null;function o(t,n,e){const s=t.substring(e,e+Math.floor(t.length/4));let r,o,c,g,h=-1,u="";for(;-1!==(h=n.indexOf(s,h+1));){const s=l(t.substring(e),n.substring(h)),f=i(t.substring(0,e),n.substring(0,h));u.length<f+s&&(u=n.substring(h-f,h)+n.substring(h,h+s),r=t.substring(0,e-f),o=t.substring(e+s),c=n.substring(0,h-f),g=n.substring(h+s))}return 2*u.length>=t.length?[r,o,c,g,u]:null}const c=o(s,r,Math.ceil(s.length/4)),g=o(s,r,Math.ceil(s.length/2));let h,u,f,a,b;if(!c&&!g)return null;h=g?c&&c[4].length>g[4].length?c:g:c;t.length>n.length?(u=h[0],f=h[1],a=h[2],b=h[3]):(a=h[0],b=h[1],u=h[2],f=h[3]);const p=h[4];return[u,f,a,b,p]}(t,b,p);if(y){const t=y[0],n=y[1],r=y[2],l=y[3],i=y[4],o=s(t,r,p,m,d),c=s(n,l,p,m,d);return o.concat([e(0,i)],c)}return m&&t.length>100&&b.length>100?function(t,r,l,b){const p=function(t,n){const e=[],s={};let r=4e4;function l(t){let n="",l=0,i=-1,o=e.length;for(;i<t.length-1;){i=t.indexOf("\n",l),-1===i&&(i=t.length-1);let c=t.substring(l,i+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,c):void 0!==s[c])?n+=String.fromCharCode(s[c]):(o===r&&(c=t.substring(l),i=t.length),n+=String.fromCharCode(o),s[c]=o,e[o++]=c),l=i+1}return n}e[0]="";const i=l(t);r=65535;const o=l(n);return{chars1:i,chars2:o,lineArray:e}}(t,r);t=p.chars1,r=p.chars2;const m=p.lineArray,d=s(t,r,l,!1,b);(function(t,n){for(let e=0;e<t.length;e++){const s=t[e][1],r=[];for(let t=0;t<s.length;t++)r[t]=n[s.charCodeAt(t)];t[e][1]=r.join("")}})(d,m),function(t){let s=!1;const r=[];let l=0,b=null,p=0,m=0,d=0,x=0,A=0;for(;p<t.length;)0===t[p][0]?(r[l++]=p,m=x,d=A,x=0,A=0,b=t[p][1]):(1===t[p][0]?x+=t[p][1].length:A+=t[p][1].length,b&&b.length<=Math.max(m,d)&&b.length<=Math.max(x,A)&&(t.splice(r[l-1],0,e(n,b)),t[r[l-1]+1][0]=1,l--,l--,p=l>0?r[l-1]:-1,m=0,d=0,x=0,A=0,b=null,s=!0)),p++;s&&a(t);(function(t){function n(t,n){if(!t||!n)return 6;const e=t.charAt(t.length-1),s=n.charAt(0),r=e.match(c),l=s.match(c),i=r&&e.match(g),o=l&&s.match(g),a=i&&e.match(h),b=o&&s.match(h),p=a&&t.match(u),m=b&&n.match(f);return p||m?5:a||b?4:r&&!i&&o?3:i||o?2:r||l?1:0}let e=1;for(;e<t.length-1;){if(0===t[e-1][0]&&0===t[e+1][0]){let s=t[e-1][1],r=t[e][1],l=t[e+1][1];const o=i(s,r);if(o){const t=r.substring(r.length-o);s=s.substring(0,s.length-o),r=t+r.substring(0,r.length-o),l=t+l}let c=s,g=r,h=l,u=n(s,r)+n(r,l);for(;r.charAt(0)===l.charAt(0);){s+=r.charAt(0),r=r.substring(1)+l.charAt(0),l=l.substring(1);const t=n(s,r)+n(r,l);t>=u&&(u=t,c=s,g=r,h=l)}t[e-1][1]!==c&&(c?t[e-1][1]=c:(t.splice(e-1,1),e--),t[e][1]=g,h?t[e+1][1]=h:(t.splice(e+1,1),e--))}e++}})(t),p=1;for(;p<t.length;){if(t[p-1][0]===n&&1===t[p][0]){const s=t[p-1][1],r=t[p][1],l=o(s,r),i=o(r,s);l>=i?(l>=s.length/2||l>=r.length/2)&&(t.splice(p,0,e(0,r.substring(0,l))),t[p-1][1]=s.substring(0,s.length-l),t[p+1][1]=r.substring(l),p++):(i>=s.length/2||i>=r.length/2)&&(t.splice(p,0,e(0,s.substring(0,i))),t[p-1][0]=1,t[p-1][1]=r.substring(0,r.length-i),t[p+1][0]=n,t[p+1][1]=s.substring(i),p++),p++}p++}}(d),d.push(e(0,""));let x=0,A=0,w=0,M="",y="";for(;x<d.length;){switch(d[x][0]){case 1:w++,y+=d[x][1];break;case n:A++,M+=d[x][1];break;case 0:if(A>=1&&w>=1){d.splice(x-A-w,A+w),x=x-A-w;const t=s(M,y,l,!1,b);for(let n=t.length-1;n>=0;n--)d.splice(x,0,t[n]);x+=t.length}w=0,A=0,M="",y=""}x++}return d.pop(),d}(t,b,p,d):function(t,s,l,i){const o=t.length,c=s.length,g=Math.ceil((o+c)/2),h=g,u=2*g,f=new Array(u),a=new Array(u);for(let t=0;t<u;t++)f[t]=-1,a[t]=-1;f[h+1]=0,a[h+1]=0;const b=o-c,p=b%2!=0;let m=0,d=0,x=0,A=0;for(let n=0;n<g&&!((new Date).getTime()>i);n++){for(let e=-n+m;e<=n-d;e+=2){const g=h+e;let x;x=e===-n||e!==n&&f[g-1]<f[g+1]?f[g+1]:f[g-1]+1;let A=x-e;for(;x<o&&A<c&&t.charAt(x)===s.charAt(A);)x++,A++;if(f[g]=x,x>o)d+=2;else if(A>c)m+=2;else if(p){const n=h+b-e;if(n>=0&&n<u&&-1!==a[n]){if(x>=o-a[n])return r(t,s,l,x,A,i)}}}for(let e=-n+x;e<=n-A;e+=2){const g=h+e;let m;m=e===-n||e!==n&&a[g-1]<a[g+1]?a[g+1]:a[g-1]+1;let d=m-e;for(;m<o&&d<c&&t.charAt(o-m-1)===s.charAt(c-d-1);)m++,d++;if(a[g]=m,m>o)A+=2;else if(d>c)x+=2;else if(!p){const n=h+b-e;if(n>=0&&n<u&&-1!==f[n]){const e=f[n];if(m=o-m,e>=m)return r(t,s,l,e,h+e-n,i)}}}}return[e(n,t),e(1,s)]}(t,b,p,d)}(b=b.substring(0,b.length-y),p=p.substring(0,p.length-y),A,M,w);return _&&v.unshift(e(0,_)),O&&v.push(e(0,O)),a(v),v}function r(t,n,e,r,l,i){const o=t.substring(0,r),c=n.substring(0,l),g=t.substring(r),h=n.substring(l),u=s(o,c,e,!1,i),f=s(g,h,e,!1,i);return u.concat(f)}function l(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,s=Math.min(t.length,n.length),r=s,l=0;for(;e<r;)t.substring(l,r)===n.substring(l,r)?(e=r,l=e):s=r,r=Math.floor((s-e)/2+e);return r}function i(t,n){if(!t||!n||t.charAt(t.length-1)!==n.charAt(n.length-1))return 0;let e=0,s=Math.min(t.length,n.length),r=s,l=0;for(;e<r;)t.substring(t.length-r,t.length-l)===n.substring(n.length-r,n.length-l)?(e=r,l=e):s=r,r=Math.floor((s-e)/2+e);return r}function o(t,n){const e=t.length,s=n.length;if(0===e||0===s)return 0;e>s?t=t.substring(e-s):e<s&&(n=n.substring(0,e));const r=Math.min(e,s);if(t===n)return r;let l=0,i=1;for(;;){const e=t.substring(r-i),s=n.indexOf(e);if(-1===s)return l;i+=s,0!==s&&t.substring(r-i)!==n.substring(0,i)||(l=i,i++)}}const c=/[^a-z0-9]/i,g=/\s/,h=/[\r\n]/,u=/\n\r?\n$/,f=/^\r?\n\r?\n/;function a(t){t.push(e(0,""));let s,r=0,o=0,c=0,g="",h="";for(;r<t.length;)switch(t[r][0]){case 1:c++,h+=t[r][1],r++;break;case n:o++,g+=t[r][1],r++;break;case 0:o+c>1?(0!==o&&0!==c&&(s=l(h,g),0!==s&&(r-o-c>0&&0===t[r-o-c-1][0]?t[r-o-c-1][1]+=h.substring(0,s):(t.splice(0,0,e(0,h.substring(0,s))),r++),h=h.substring(s),g=g.substring(s)),s=i(h,g),0!==s&&(t[r][1]=h.substring(h.length-s)+t[r][1],h=h.substring(0,h.length-s),g=g.substring(0,g.length-s))),r-=o+c,t.splice(r,o+c),g.length&&(t.splice(r,0,e(n,g)),r++),h.length&&(t.splice(r,0,e(1,h)),r++),r++):0!==r&&0===t[r-1][0]?(t[r-1][1]+=t[r][1],t.splice(r,1)):r++,c=0,o=0,g="",h=""}""===t[t.length-1][1]&&t.pop();let u=!1;for(r=1;r<t.length-1;)0===t[r-1][0]&&0===t[r+1][0]&&(t[r][1].substring(t[r][1].length-t[r-1][1].length)===t[r-1][1]?(t[r][1]=t[r-1][1]+t[r][1].substring(0,t[r][1].length-t[r-1][1].length),t[r+1][1]=t[r-1][1]+t[r+1][1],t.splice(r-1,1),u=!0):t[r][1].substring(0,t[r+1][1].length)===t[r+1][1]&&(t[r-1][1]+=t[r+1][1],t[r][1]=t[r][1].substring(t[r+1][1].length)+t[r+1][1],t.splice(r+1,1),u=!0)),r++;u&&a(t)}const b=t=>"[33m"+t+"[0m",p=t=>"[2m"+t+"[0m",m={context_size:40},d=t=>' <span style="color:gray">'+t+"\n</span> ",x={context_size:40},A={context_size:40},w=function(t){const n=[];let e=0;for(const[s,r]of t)0!==s&&n.push({op:s,text:r,pos:e}),1!==s&&(e+=r.length);return n},M=function(t,n,e){let r=s(t,n);!function(t,n,e={}){const s=Object.assign({},m,e);t.forEach((t,e)=>{let{op:r,text:l,pos:i}=t;console.log(b("\n\n- #"+(e+1)+" ------"));const o=Math.max(0,i-s.context_size),c=n.slice(o,i),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);process.stdout.write(p(c)),-1===r?process.stdout.write("[31m-"+l+"[0m"):1===r?process.stdout.write("[32m"+("+"+l)+"[0m"):process.stdout.write(b(" "+l)),process.stdout.write(p(g))}),console.log("\n")}(w(r),t,e)},y=function(t,n,e){let r=s(t,n);w(r);!function(t,n,e={}){Object.assign({},A,e)}(0,0,e)},_=function(t,n,e){let r=s(t,n);return function(t,n,e={}){const s=Object.assign({},x,e);let r="";return t.forEach((t,e)=>{let{op:l,text:i,pos:o}=t;r+="<div> #"+(e+1)+" </div>\n\n";const c=Math.max(0,o-s.context_size),g=n.slice(c,o),h=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);r+=d(g)+"\n",r+=-1===l?' <span style="color:red">-'+i+"</span> \n":1===l?' <span style="color:green">'+("+"+i)+"</span> \n":(t=>' <span style="color:yellow">'+t+"</span> ")(" "+i)+"\n",r+=d(h)+"\n"}),"<div>\n"+r+"\n</div>"}(w(r),t,e)};export{M as diffCli,y as diffConsole,_ as diffHtml};
