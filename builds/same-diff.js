const t=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});const n=-1;function e(t,n){return[t,n]}function s(p,b,d,m=!0,x){const w=function(n){if(n?.__resolved)return n;const e={...t,...n};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}(d);void 0===x&&(x=w.diffTimeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*w.diffTimeout);const _=x;if(null==p||null==b)throw new Error("Null input. (diff_main)");if(p===b)return p?[e(0,p)]:[];const A=m;let M=o(p,b);const y=p.substring(0,M);M=l(p=p.substring(M),b=b.substring(M));const O=p.substring(p.length-M),$=function(t,p,b,d,m){let x;if(!t)return[e(1,p)];if(!p)return[e(n,t)];const w=t.length>p.length?t:p,_=t.length>p.length?p:t,A=w.indexOf(_);if(-1!==A)return x=[e(1,w.substring(0,A)),e(0,_),e(1,w.substring(A+_.length))],t.length>p.length&&(x[0][0]=x[2][0]=n),x;if(1===_.length)return[e(n,t),e(1,p)];const M=function(t,n,e){if(e.diffTimeout<=0)return null;const s=t.length>n.length?t:n,r=t.length>n.length?n:t;if(s.length<4||2*r.length<s.length)return null;function c(t,n,e){const s=t.substring(e,e+Math.floor(t.length/4));let r,c,i,g,h=-1,u="";for(;-1!==(h=n.indexOf(s,h+1));){const s=o(t.substring(e),n.substring(h)),f=l(t.substring(0,e),n.substring(0,h));u.length<f+s&&(u=n.substring(h-f,h)+n.substring(h,h+s),r=t.substring(0,e-f),c=t.substring(e+s),i=n.substring(0,h-f),g=n.substring(h+s))}return 2*u.length>=t.length?[r,c,i,g,u]:null}const i=c(s,r,Math.ceil(s.length/4)),g=c(s,r,Math.ceil(s.length/2));let h,u,f,a,p;if(!i&&!g)return null;h=g?i&&i[4].length>g[4].length?i:g:i;t.length>n.length?(u=h[0],f=h[1],a=h[2],p=h[3]):(a=h[0],p=h[1],u=h[2],f=h[3]);const b=h[4];return[u,f,a,p,b]}(t,p,b);if(M){const t=M[0],n=M[1],r=M[2],o=M[3],l=M[4],c=s(t,r,b,d,m),i=s(n,o,b,d,m);return c.concat([e(0,l)],i)}return d&&t.length>100&&p.length>100?function(t,r,o,p){const b=function(t,n){const e=[],s={};let r=4e4;function o(t){let n="",o=0,l=-1,c=e.length;for(;l<t.length-1;){l=t.indexOf("\n",o),-1===l&&(l=t.length-1);let i=t.substring(o,l+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,i):void 0!==s[i])?n+=String.fromCharCode(s[i]):(c===r&&(i=t.substring(o),l=t.length),n+=String.fromCharCode(c),s[i]=c,e[c++]=i),o=l+1}return n}e[0]="";const l=o(t);r=65535;const c=o(n);return{chars1:l,chars2:c,lineArray:e}}(t,r);t=b.chars1,r=b.chars2;const d=b.lineArray,m=s(t,r,o,!1,p);(function(t,n){for(let e=0;e<t.length;e++){const s=t[e][1],r=[];for(let t=0;t<s.length;t++)r[t]=n[s.charCodeAt(t)];t[e][1]=r.join("")}})(m,d),function(t){let s=!1;const r=[];let o=0,p=null,b=0,d=0,m=0,x=0,w=0;for(;b<t.length;)0===t[b][0]?(r[o++]=b,d=x,m=w,x=0,w=0,p=t[b][1]):(1===t[b][0]?x+=t[b][1].length:w+=t[b][1].length,p&&p.length<=Math.max(d,m)&&p.length<=Math.max(x,w)&&(t.splice(r[o-1],0,e(n,p)),t[r[o-1]+1][0]=1,o--,o--,b=o>0?r[o-1]:-1,d=0,m=0,x=0,w=0,p=null,s=!0)),b++;s&&a(t);(function(t){function n(t,n){if(!t||!n)return 6;const e=t.charAt(t.length-1),s=n.charAt(0),r=e.match(i),o=s.match(i),l=r&&e.match(g),c=o&&s.match(g),a=l&&e.match(h),p=c&&s.match(h),b=a&&t.match(u),d=p&&n.match(f);return b||d?5:a||p?4:r&&!l&&c?3:l||c?2:r||o?1:0}let e=1;for(;e<t.length-1;){if(0===t[e-1][0]&&0===t[e+1][0]){let s=t[e-1][1],r=t[e][1],o=t[e+1][1];const c=l(s,r);if(c){const t=r.substring(r.length-c);s=s.substring(0,s.length-c),r=t+r.substring(0,r.length-c),o=t+o}let i=s,g=r,h=o,u=n(s,r)+n(r,o);for(;r.charAt(0)===o.charAt(0);){s+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);const t=n(s,r)+n(r,o);t>=u&&(u=t,i=s,g=r,h=o)}t[e-1][1]!==i&&(i?t[e-1][1]=i:(t.splice(e-1,1),e--),t[e][1]=g,h?t[e+1][1]=h:(t.splice(e+1,1),e--))}e++}})(t),b=1;for(;b<t.length;){if(t[b-1][0]===n&&1===t[b][0]){const s=t[b-1][1],r=t[b][1],o=c(s,r),l=c(r,s);o>=l?(o>=s.length/2||o>=r.length/2)&&(t.splice(b,0,e(0,r.substring(0,o))),t[b-1][1]=s.substring(0,s.length-o),t[b+1][1]=r.substring(o),b++):(l>=s.length/2||l>=r.length/2)&&(t.splice(b,0,e(0,s.substring(0,l))),t[b-1][0]=1,t[b-1][1]=r.substring(0,r.length-l),t[b+1][0]=n,t[b+1][1]=s.substring(l),b++),b++}b++}}(m),m.push(e(0,""));let x=0,w=0,_=0,A="",M="";for(;x<m.length;){switch(m[x][0]){case 1:_++,M+=m[x][1];break;case n:w++,A+=m[x][1];break;case 0:if(w>=1&&_>=1){m.splice(x-w-_,w+_),x=x-w-_;const t=s(A,M,o,!1,p);for(let n=t.length-1;n>=0;n--)m.splice(x,0,t[n]);x+=t.length}_=0,w=0,A="",M=""}x++}return m.pop(),m}(t,p,b,m):function(t,s,o,l){const c=t.length,i=s.length,g=Math.ceil((c+i)/2),h=g,u=2*g,f=new Array(u),a=new Array(u);for(let t=0;t<u;t++)f[t]=-1,a[t]=-1;f[h+1]=0,a[h+1]=0;const p=c-i,b=p%2!=0;let d=0,m=0,x=0,w=0;for(let n=0;n<g&&!((new Date).getTime()>l);n++){for(let e=-n+d;e<=n-m;e+=2){const g=h+e;let x;x=e===-n||e!==n&&f[g-1]<f[g+1]?f[g+1]:f[g-1]+1;let w=x-e;for(;x<c&&w<i&&t.charAt(x)===s.charAt(w);)x++,w++;if(f[g]=x,x>c)m+=2;else if(w>i)d+=2;else if(b){const n=h+p-e;if(n>=0&&n<u&&-1!==a[n]){if(x>=c-a[n])return r(t,s,o,x,w,l)}}}for(let e=-n+x;e<=n-w;e+=2){const g=h+e;let d;d=e===-n||e!==n&&a[g-1]<a[g+1]?a[g+1]:a[g-1]+1;let m=d-e;for(;d<c&&m<i&&t.charAt(c-d-1)===s.charAt(i-m-1);)d++,m++;if(a[g]=d,d>c)w+=2;else if(m>i)x+=2;else if(!b){const n=h+p-e;if(n>=0&&n<u&&-1!==f[n]){const e=f[n];if(d=c-d,e>=d)return r(t,s,o,e,h+e-n,l)}}}}return[e(n,t),e(1,s)]}(t,p,b,m)}(p=p.substring(0,p.length-M),b=b.substring(0,b.length-M),w,A,_);return y&&$.unshift(e(0,y)),O&&$.push(e(0,O)),a($),$}function r(t,n,e,r,o,l){const c=t.substring(0,r),i=n.substring(0,o),g=t.substring(r),h=n.substring(o),u=s(c,i,e,!1,l),f=s(g,h,e,!1,l);return u.concat(f)}function o(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,s=Math.min(t.length,n.length),r=s,o=0;for(;e<r;)t.substring(o,r)===n.substring(o,r)?(e=r,o=e):s=r,r=Math.floor((s-e)/2+e);return r}function l(t,n){if(!t||!n||t.charAt(t.length-1)!==n.charAt(n.length-1))return 0;let e=0,s=Math.min(t.length,n.length),r=s,o=0;for(;e<r;)t.substring(t.length-r,t.length-o)===n.substring(n.length-r,n.length-o)?(e=r,o=e):s=r,r=Math.floor((s-e)/2+e);return r}function c(t,n){const e=t.length,s=n.length;if(0===e||0===s)return 0;e>s?t=t.substring(e-s):e<s&&(n=n.substring(0,e));const r=Math.min(e,s);if(t===n)return r;let o=0,l=1;for(;;){const e=t.substring(r-l),s=n.indexOf(e);if(-1===s)return o;l+=s,0!==s&&t.substring(r-l)!==n.substring(0,l)||(o=l,l++)}}const i=/[^a-z0-9]/i,g=/\s/,h=/[\r\n]/,u=/\n\r?\n$/,f=/^\r?\n\r?\n/;function a(t){t.push(e(0,""));let s,r=0,c=0,i=0,g="",h="";for(;r<t.length;)switch(t[r][0]){case 1:i++,h+=t[r][1],r++;break;case n:c++,g+=t[r][1],r++;break;case 0:c+i>1?(0!==c&&0!==i&&(s=o(h,g),0!==s&&(r-c-i>0&&0===t[r-c-i-1][0]?t[r-c-i-1][1]+=h.substring(0,s):(t.splice(0,0,e(0,h.substring(0,s))),r++),h=h.substring(s),g=g.substring(s)),s=l(h,g),0!==s&&(t[r][1]=h.substring(h.length-s)+t[r][1],h=h.substring(0,h.length-s),g=g.substring(0,g.length-s))),r-=c+i,t.splice(r,c+i),g.length&&(t.splice(r,0,e(n,g)),r++),h.length&&(t.splice(r,0,e(1,h)),r++),r++):0!==r&&0===t[r-1][0]?(t[r-1][1]+=t[r][1],t.splice(r,1)):r++,i=0,c=0,g="",h=""}""===t[t.length-1][1]&&t.pop();let u=!1;for(r=1;r<t.length-1;)0===t[r-1][0]&&0===t[r+1][0]&&(t[r][1].substring(t[r][1].length-t[r-1][1].length)===t[r-1][1]?(t[r][1]=t[r-1][1]+t[r][1].substring(0,t[r][1].length-t[r-1][1].length),t[r+1][1]=t[r-1][1]+t[r+1][1],t.splice(r-1,1),u=!0):t[r][1].substring(0,t[r+1][1].length)===t[r+1][1]&&(t[r-1][1]+=t[r+1][1],t[r][1]=t[r][1].substring(t[r+1][1].length)+t[r+1][1],t.splice(r+1,1),u=!0)),r++;u&&a(t)}const p=t=>"[2m"+t+"[0m";"undefined"==typeof process&&(window.process={},process.stdout=process.stdout||{},process.stdout.write=function(t){console.log(t)});const b={context_size:40},d={context_size:40,green_color:"#64a166",red_color:"#b54545",yellow_color:"#dbda81"},m={context_size:40,green_color:"#64a166",red_color:"#b54545",yellow_color:"#dbda81"},x=function(t){const n=[];let e=0;for(const[s,r]of t)0!==s&&n.push({op:s,text:r,pos:e}),1!==s&&(e+=r.length);return n},w=function(t,n,e){let r=s(t,n);!function(t,n,e={}){const s=Object.assign({},b,e);t.forEach((t,e)=>{let{op:r,text:o,pos:l}=t;process.stdout.write("\n");const c=Math.max(0,l-s.context_size),i=n.slice(c,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);process.stdout.write(p(i)),-1===r?process.stdout.write("[31m-"+o+"[0m"):1===r?process.stdout.write("[32m"+("+"+o)+"[0m"):process.stdout.write((t=>"[33m"+t+"[0m")(" "+o)),process.stdout.write(p(g))}),process.stdout.write("\n\n\n")}(x(r),t,e)},_=function(t,n,e){let r=s(t,n);!function(t,n,e={}){const s=Object.assign({},m,e);t.forEach((t,e)=>{let{op:r,text:o,pos:l}=t;const c=Math.max(0,l-s.context_size),i=n.slice(c,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);-1===r?console.log(i+"%c-"+o,`color: white; background-color: ${s.red_color}; padding: 2px,`,g):1===r?console.log(i+"%c+"+o,`color: white; background-color: ${s.green_color}; padding: 2px;`,g):console.log(i+"%c "+o,`color: white; background-color: ${s.yellow_color}; padding: 2px;`,g)})}(x(r),t,e)},A=function(t,n,e){let r=s(t,n);return function(t,n,e={}){const s=Object.assign({},d,e);let r="";return t.forEach((t,e)=>{let{op:o,text:l,pos:c}=t;const i=Math.max(0,c-s.context_size),g=n.slice(i,c),h=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);r+='<div class="diff-each">',r+=`<span class='diff-before'>${g}</span>\n`,r+=-1===o?`<span class='diff diff-minus' style="color:${s.red_color}">-${l}</span>\n`:1===o?`<span class='diff diff-plus' style="color:${s.green_color}">+${l}</span>\n`:`<span class='diff diff-change' style="color:${s.yellow_color}"> ${l}</span>\n`,r+=`<span class='diff-after'>${h}</span>\n`,r+="</div>"}),'<div class="diff-container">\n'+r+"\n</div>"}(x(r),t,e)};export{w as diffCli,_ as diffConsole,A as diffHtml};
