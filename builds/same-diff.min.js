!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self)["same-diff"]={})}(this,function(t){"use strict";const n=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});const e=-1;function s(t,n){return[t,n]}function r(t,p,d,m=!0,x){const A=function(t){if(t?.__resolved)return t;const e={...n,...t};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}(d);void 0===x&&(x=A.diffTimeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*A.diffTimeout);const y=x;if(null==t||null==p)throw new Error("Null input. (diff_main)");if(t===p)return t?[s(0,t)]:[];const w=m;let M=l(t,p);const _=t.substring(0,M);M=o(t=t.substring(M),p=p.substring(M));const O=t.substring(t.length-M),T=function(t,n,p,d,m){let x;if(!t)return[s(1,n)];if(!n)return[s(e,t)];const A=t.length>n.length?t:n,y=t.length>n.length?n:t,w=A.indexOf(y);if(-1!==w)return x=[s(1,A.substring(0,w)),s(0,y),s(1,A.substring(w+y.length))],t.length>n.length&&(x[0][0]=x[2][0]=e),x;if(1===y.length)return[s(e,t),s(1,n)];const M=function(t,n,e){if(e.diffTimeout<=0)return null;const s=t.length>n.length?t:n,r=t.length>n.length?n:t;if(s.length<4||2*r.length<s.length)return null;function i(t,n,e){const s=t.substring(e,e+Math.floor(t.length/4));let r,i,c,g,h=-1,u="";for(;-1!==(h=n.indexOf(s,h+1));){const s=l(t.substring(e),n.substring(h)),f=o(t.substring(0,e),n.substring(0,h));u.length<f+s&&(u=n.substring(h-f,h)+n.substring(h,h+s),r=t.substring(0,e-f),i=t.substring(e+s),c=n.substring(0,h-f),g=n.substring(h+s))}return 2*u.length>=t.length?[r,i,c,g,u]:null}const c=i(s,r,Math.ceil(s.length/4)),g=i(s,r,Math.ceil(s.length/2));let h,u,f,a,b;if(!c&&!g)return null;h=g?c&&c[4].length>g[4].length?c:g:c;t.length>n.length?(u=h[0],f=h[1],a=h[2],b=h[3]):(a=h[0],b=h[1],u=h[2],f=h[3]);const p=h[4];return[u,f,a,b,p]}(t,n,p);if(M){const t=M[0],n=M[1],e=M[2],i=M[3],l=M[4],o=r(t,e,p,d,m),c=r(n,i,p,d,m);return o.concat([s(0,l)],c)}return d&&t.length>100&&n.length>100?function(t,n,i,l){const p=function(t,n){const e=[],s={};let r=4e4;function i(t){let n="",i=0,l=-1,o=e.length;for(;l<t.length-1;){l=t.indexOf("\n",i),-1===l&&(l=t.length-1);let c=t.substring(i,l+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,c):void 0!==s[c])?n+=String.fromCharCode(s[c]):(o===r&&(c=t.substring(i),l=t.length),n+=String.fromCharCode(o),s[c]=o,e[o++]=c),i=l+1}return n}e[0]="";const l=i(t);r=65535;const o=i(n);return{chars1:l,chars2:o,lineArray:e}}(t,n);t=p.chars1,n=p.chars2;const d=p.lineArray,m=r(t,n,i,!1,l);(function(t,n){for(let e=0;e<t.length;e++){const s=t[e][1],r=[];for(let t=0;t<s.length;t++)r[t]=n[s.charCodeAt(t)];t[e][1]=r.join("")}})(m,d),function(t){let n=!1;const r=[];let i=0,l=null,p=0,d=0,m=0,x=0,A=0;for(;p<t.length;)0===t[p][0]?(r[i++]=p,d=x,m=A,x=0,A=0,l=t[p][1]):(1===t[p][0]?x+=t[p][1].length:A+=t[p][1].length,l&&l.length<=Math.max(d,m)&&l.length<=Math.max(x,A)&&(t.splice(r[i-1],0,s(e,l)),t[r[i-1]+1][0]=1,i--,i--,p=i>0?r[i-1]:-1,d=0,m=0,x=0,A=0,l=null,n=!0)),p++;n&&b(t);(function(t){function n(t,n){if(!t||!n)return 6;const e=t.charAt(t.length-1),s=n.charAt(0),r=e.match(g),i=s.match(g),l=r&&e.match(h),o=i&&s.match(h),c=l&&e.match(u),b=o&&s.match(u),p=c&&t.match(f),d=b&&n.match(a);return p||d?5:c||b?4:r&&!l&&o?3:l||o?2:r||i?1:0}let e=1;for(;e<t.length-1;){if(0===t[e-1][0]&&0===t[e+1][0]){let s=t[e-1][1],r=t[e][1],i=t[e+1][1];const l=o(s,r);if(l){const t=r.substring(r.length-l);s=s.substring(0,s.length-l),r=t+r.substring(0,r.length-l),i=t+i}let c=s,g=r,h=i,u=n(s,r)+n(r,i);for(;r.charAt(0)===i.charAt(0);){s+=r.charAt(0),r=r.substring(1)+i.charAt(0),i=i.substring(1);const t=n(s,r)+n(r,i);t>=u&&(u=t,c=s,g=r,h=i)}t[e-1][1]!==c&&(c?t[e-1][1]=c:(t.splice(e-1,1),e--),t[e][1]=g,h?t[e+1][1]=h:(t.splice(e+1,1),e--))}e++}})(t),p=1;for(;p<t.length;){if(t[p-1][0]===e&&1===t[p][0]){const n=t[p-1][1],r=t[p][1],i=c(n,r),l=c(r,n);i>=l?(i>=n.length/2||i>=r.length/2)&&(t.splice(p,0,s(0,r.substring(0,i))),t[p-1][1]=n.substring(0,n.length-i),t[p+1][1]=r.substring(i),p++):(l>=n.length/2||l>=r.length/2)&&(t.splice(p,0,s(0,n.substring(0,l))),t[p-1][0]=1,t[p-1][1]=r.substring(0,r.length-l),t[p+1][0]=e,t[p+1][1]=n.substring(l),p++),p++}p++}}(m),m.push(s(0,""));let x=0,A=0,y=0,w="",M="";for(;x<m.length;){switch(m[x][0]){case 1:y++,M+=m[x][1];break;case e:A++,w+=m[x][1];break;case 0:if(A>=1&&y>=1){m.splice(x-A-y,A+y),x=x-A-y;const t=r(w,M,i,!1,l);for(let n=t.length-1;n>=0;n--)m.splice(x,0,t[n]);x+=t.length}y=0,A=0,w="",M=""}x++}return m.pop(),m}(t,n,p,m):function(t,n,r,l){const o=t.length,c=n.length,g=Math.ceil((o+c)/2),h=g,u=2*g,f=new Array(u),a=new Array(u);for(let t=0;t<u;t++)f[t]=-1,a[t]=-1;f[h+1]=0,a[h+1]=0;const b=o-c,p=b%2!=0;let d=0,m=0,x=0,A=0;for(let e=0;e<g&&!((new Date).getTime()>l);e++){for(let s=-e+d;s<=e-m;s+=2){const g=h+s;let x;x=s===-e||s!==e&&f[g-1]<f[g+1]?f[g+1]:f[g-1]+1;let A=x-s;for(;x<o&&A<c&&t.charAt(x)===n.charAt(A);)x++,A++;if(f[g]=x,x>o)m+=2;else if(A>c)d+=2;else if(p){const e=h+b-s;if(e>=0&&e<u&&-1!==a[e]){if(x>=o-a[e])return i(t,n,r,x,A,l)}}}for(let s=-e+x;s<=e-A;s+=2){const g=h+s;let d;d=s===-e||s!==e&&a[g-1]<a[g+1]?a[g+1]:a[g-1]+1;let m=d-s;for(;d<o&&m<c&&t.charAt(o-d-1)===n.charAt(c-m-1);)d++,m++;if(a[g]=d,d>o)A+=2;else if(m>c)x+=2;else if(!p){const e=h+b-s;if(e>=0&&e<u&&-1!==f[e]){const s=f[e];if(d=o-d,s>=d)return i(t,n,r,s,h+s-e,l)}}}}return[s(e,t),s(1,n)]}(t,n,p,m)}(t=t.substring(0,t.length-M),p=p.substring(0,p.length-M),A,w,y);return _&&T.unshift(s(0,_)),O&&T.push(s(0,O)),b(T),T}function i(t,n,e,s,i,l){const o=t.substring(0,s),c=n.substring(0,i),g=t.substring(s),h=n.substring(i),u=r(o,c,e,!1,l),f=r(g,h,e,!1,l);return u.concat(f)}function l(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,s=Math.min(t.length,n.length),r=s,i=0;for(;e<r;)t.substring(i,r)===n.substring(i,r)?(e=r,i=e):s=r,r=Math.floor((s-e)/2+e);return r}function o(t,n){if(!t||!n||t.charAt(t.length-1)!==n.charAt(n.length-1))return 0;let e=0,s=Math.min(t.length,n.length),r=s,i=0;for(;e<r;)t.substring(t.length-r,t.length-i)===n.substring(n.length-r,n.length-i)?(e=r,i=e):s=r,r=Math.floor((s-e)/2+e);return r}function c(t,n){const e=t.length,s=n.length;if(0===e||0===s)return 0;e>s?t=t.substring(e-s):e<s&&(n=n.substring(0,e));const r=Math.min(e,s);if(t===n)return r;let i=0,l=1;for(;;){const e=t.substring(r-l),s=n.indexOf(e);if(-1===s)return i;l+=s,0!==s&&t.substring(r-l)!==n.substring(0,l)||(i=l,l++)}}const g=/[^a-z0-9]/i,h=/\s/,u=/[\r\n]/,f=/\n\r?\n$/,a=/^\r?\n\r?\n/;function b(t){t.push(s(0,""));let n,r=0,i=0,c=0,g="",h="";for(;r<t.length;)switch(t[r][0]){case 1:c++,h+=t[r][1],r++;break;case e:i++,g+=t[r][1],r++;break;case 0:i+c>1?(0!==i&&0!==c&&(n=l(h,g),0!==n&&(r-i-c>0&&0===t[r-i-c-1][0]?t[r-i-c-1][1]+=h.substring(0,n):(t.splice(0,0,s(0,h.substring(0,n))),r++),h=h.substring(n),g=g.substring(n)),n=o(h,g),0!==n&&(t[r][1]=h.substring(h.length-n)+t[r][1],h=h.substring(0,h.length-n),g=g.substring(0,g.length-n))),r-=i+c,t.splice(r,i+c),g.length&&(t.splice(r,0,s(e,g)),r++),h.length&&(t.splice(r,0,s(1,h)),r++),r++):0!==r&&0===t[r-1][0]?(t[r-1][1]+=t[r][1],t.splice(r,1)):r++,c=0,i=0,g="",h=""}""===t[t.length-1][1]&&t.pop();let u=!1;for(r=1;r<t.length-1;)0===t[r-1][0]&&0===t[r+1][0]&&(t[r][1].substring(t[r][1].length-t[r-1][1].length)===t[r-1][1]?(t[r][1]=t[r-1][1]+t[r][1].substring(0,t[r][1].length-t[r-1][1].length),t[r+1][1]=t[r-1][1]+t[r+1][1],t.splice(r-1,1),u=!0):t[r][1].substring(0,t[r+1][1].length)===t[r+1][1]&&(t[r-1][1]+=t[r+1][1],t[r][1]=t[r][1].substring(t[r+1][1].length)+t[r+1][1],t.splice(r+1,1),u=!0)),r++;u&&b(t)}const p=t=>"[33m"+t+"[0m",d=t=>"[2m"+t+"[0m",m={context_size:40},x=t=>' <span style="color:gray">'+t+"\n</span> ",A={context_size:40},y={context_size:40},w=function(t){const n=[];let e=0;for(const[s,r]of t)0!==s&&n.push({op:s,text:r,pos:e}),1!==s&&(e+=r.length);return n};t.diffCli=function(t,n,e){let s=r(t,n);!function(t,n,e={}){const s=Object.assign({},m,e);t.forEach((t,e)=>{let{op:r,text:i,pos:l}=t;console.log(p("\n\n- #"+(e+1)+" ------"));const o=Math.max(0,l-s.context_size),c=n.slice(o,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);process.stdout.write(d(c)),-1===r?process.stdout.write("[31m-"+i+"[0m"):1===r?process.stdout.write("[32m"+("+"+i)+"[0m"):process.stdout.write(p(" "+i)),process.stdout.write(d(g))}),console.log("\n")}(w(s),t,e)},t.diffConsole=function(t,n,e){let s=r(t,n);w(s);!function(t,n,e={}){Object.assign({},y,e)}(0,0,e)},t.diffHtml=function(t,n,e){let s=r(t,n);return function(t,n,e={}){const s=Object.assign({},A,e);let r="";return t.forEach((t,e)=>{let{op:i,text:l,pos:o}=t;r+="<div> #"+(e+1)+" </div>\n\n";const c=Math.max(0,o-s.context_size),g=n.slice(c,o),h=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);r+=x(g)+"\n",r+=-1===i?' <span style="color:red">-'+l+"</span> \n":1===i?' <span style="color:green">'+("+"+l)+"</span> \n":(t=>' <span style="color:yellow">'+t+"</span> ")(" "+l)+"\n",r+=x(h)+"\n"}),"<div>\n"+r+"\n</div>"}(w(s),t,e)}});
