!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).sameDiff={})}(this,function(t){"use strict";const n=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});const e=-1;function s(t,n){return[t,n]}function o(t,b,d,m=!0,x){const _=function(t){if(t?.__resolved)return t;const e={...n,...t};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}(d);void 0===x&&(x=_.diffTimeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*_.diffTimeout);const w=x;if(null==t||null==b)throw new Error("Null input. (diff_main)");if(t===b)return t?[s(0,t)]:[];const A=m;let y=l(t,b);const M=t.substring(0,y);y=i(t=t.substring(y),b=b.substring(y));const O=t.substring(t.length-y),$=function(t,n,b,d,m){let x;if(!t)return[s(1,n)];if(!n)return[s(e,t)];const _=t.length>n.length?t:n,w=t.length>n.length?n:t,A=_.indexOf(w);if(-1!==A)return x=[s(1,_.substring(0,A)),s(0,w),s(1,_.substring(A+w.length))],t.length>n.length&&(x[0][0]=x[2][0]=e),x;if(1===w.length)return[s(e,t),s(1,n)];const y=function(t,n,e){if(e.diffTimeout<=0)return null;const s=t.length>n.length?t:n,o=t.length>n.length?n:t;if(s.length<4||2*o.length<s.length)return null;function r(t,n,e){const s=t.substring(e,e+Math.floor(t.length/4));let o,r,c,g,h=-1,u="";for(;-1!==(h=n.indexOf(s,h+1));){const s=l(t.substring(e),n.substring(h)),f=i(t.substring(0,e),n.substring(0,h));u.length<f+s&&(u=n.substring(h-f,h)+n.substring(h,h+s),o=t.substring(0,e-f),r=t.substring(e+s),c=n.substring(0,h-f),g=n.substring(h+s))}return 2*u.length>=t.length?[o,r,c,g,u]:null}const c=r(s,o,Math.ceil(s.length/4)),g=r(s,o,Math.ceil(s.length/2));let h,u,f,a,p;if(!c&&!g)return null;h=g?c&&c[4].length>g[4].length?c:g:c;t.length>n.length?(u=h[0],f=h[1],a=h[2],p=h[3]):(a=h[0],p=h[1],u=h[2],f=h[3]);const b=h[4];return[u,f,a,p,b]}(t,n,b);if(y){const t=y[0],n=y[1],e=y[2],r=y[3],l=y[4],i=o(t,e,b,d,m),c=o(n,r,b,d,m);return i.concat([s(0,l)],c)}return d&&t.length>100&&n.length>100?function(t,n,r,l){const b=function(t,n){const e=[],s={};let o=4e4;function r(t){let n="",r=0,l=-1,i=e.length;for(;l<t.length-1;){l=t.indexOf("\n",r),-1===l&&(l=t.length-1);let c=t.substring(r,l+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,c):void 0!==s[c])?n+=String.fromCharCode(s[c]):(i===o&&(c=t.substring(r),l=t.length),n+=String.fromCharCode(i),s[c]=i,e[i++]=c),r=l+1}return n}e[0]="";const l=r(t);o=65535;const i=r(n);return{chars1:l,chars2:i,lineArray:e}}(t,n);t=b.chars1,n=b.chars2;const d=b.lineArray,m=o(t,n,r,!1,l);(function(t,n){for(let e=0;e<t.length;e++){const s=t[e][1],o=[];for(let t=0;t<s.length;t++)o[t]=n[s.charCodeAt(t)];t[e][1]=o.join("")}})(m,d),function(t){let n=!1;const o=[];let r=0,l=null,b=0,d=0,m=0,x=0,_=0;for(;b<t.length;)0===t[b][0]?(o[r++]=b,d=x,m=_,x=0,_=0,l=t[b][1]):(1===t[b][0]?x+=t[b][1].length:_+=t[b][1].length,l&&l.length<=Math.max(d,m)&&l.length<=Math.max(x,_)&&(t.splice(o[r-1],0,s(e,l)),t[o[r-1]+1][0]=1,r--,r--,b=r>0?o[r-1]:-1,d=0,m=0,x=0,_=0,l=null,n=!0)),b++;n&&p(t);(function(t){function n(t,n){if(!t||!n)return 6;const e=t.charAt(t.length-1),s=n.charAt(0),o=e.match(g),r=s.match(g),l=o&&e.match(h),i=r&&s.match(h),c=l&&e.match(u),p=i&&s.match(u),b=c&&t.match(f),d=p&&n.match(a);return b||d?5:c||p?4:o&&!l&&i?3:l||i?2:o||r?1:0}let e=1;for(;e<t.length-1;){if(0===t[e-1][0]&&0===t[e+1][0]){let s=t[e-1][1],o=t[e][1],r=t[e+1][1];const l=i(s,o);if(l){const t=o.substring(o.length-l);s=s.substring(0,s.length-l),o=t+o.substring(0,o.length-l),r=t+r}let c=s,g=o,h=r,u=n(s,o)+n(o,r);for(;o.charAt(0)===r.charAt(0);){s+=o.charAt(0),o=o.substring(1)+r.charAt(0),r=r.substring(1);const t=n(s,o)+n(o,r);t>=u&&(u=t,c=s,g=o,h=r)}t[e-1][1]!==c&&(c?t[e-1][1]=c:(t.splice(e-1,1),e--),t[e][1]=g,h?t[e+1][1]=h:(t.splice(e+1,1),e--))}e++}})(t),b=1;for(;b<t.length;){if(t[b-1][0]===e&&1===t[b][0]){const n=t[b-1][1],o=t[b][1],r=c(n,o),l=c(o,n);r>=l?(r>=n.length/2||r>=o.length/2)&&(t.splice(b,0,s(0,o.substring(0,r))),t[b-1][1]=n.substring(0,n.length-r),t[b+1][1]=o.substring(r),b++):(l>=n.length/2||l>=o.length/2)&&(t.splice(b,0,s(0,n.substring(0,l))),t[b-1][0]=1,t[b-1][1]=o.substring(0,o.length-l),t[b+1][0]=e,t[b+1][1]=n.substring(l),b++),b++}b++}}(m),m.push(s(0,""));let x=0,_=0,w=0,A="",y="";for(;x<m.length;){switch(m[x][0]){case 1:w++,y+=m[x][1];break;case e:_++,A+=m[x][1];break;case 0:if(_>=1&&w>=1){m.splice(x-_-w,_+w),x=x-_-w;const t=o(A,y,r,!1,l);for(let n=t.length-1;n>=0;n--)m.splice(x,0,t[n]);x+=t.length}w=0,_=0,A="",y=""}x++}return m.pop(),m}(t,n,b,m):function(t,n,o,l){const i=t.length,c=n.length,g=Math.ceil((i+c)/2),h=g,u=2*g,f=new Array(u),a=new Array(u);for(let t=0;t<u;t++)f[t]=-1,a[t]=-1;f[h+1]=0,a[h+1]=0;const p=i-c,b=p%2!=0;let d=0,m=0,x=0,_=0;for(let e=0;e<g&&!((new Date).getTime()>l);e++){for(let s=-e+d;s<=e-m;s+=2){const g=h+s;let x;x=s===-e||s!==e&&f[g-1]<f[g+1]?f[g+1]:f[g-1]+1;let _=x-s;for(;x<i&&_<c&&t.charAt(x)===n.charAt(_);)x++,_++;if(f[g]=x,x>i)m+=2;else if(_>c)d+=2;else if(b){const e=h+p-s;if(e>=0&&e<u&&-1!==a[e]){if(x>=i-a[e])return r(t,n,o,x,_,l)}}}for(let s=-e+x;s<=e-_;s+=2){const g=h+s;let d;d=s===-e||s!==e&&a[g-1]<a[g+1]?a[g+1]:a[g-1]+1;let m=d-s;for(;d<i&&m<c&&t.charAt(i-d-1)===n.charAt(c-m-1);)d++,m++;if(a[g]=d,d>i)_+=2;else if(m>c)x+=2;else if(!b){const e=h+p-s;if(e>=0&&e<u&&-1!==f[e]){const s=f[e];if(d=i-d,s>=d)return r(t,n,o,s,h+s-e,l)}}}}return[s(e,t),s(1,n)]}(t,n,b,m)}(t=t.substring(0,t.length-y),b=b.substring(0,b.length-y),_,A,w);return M&&$.unshift(s(0,M)),O&&$.push(s(0,O)),p($),$}function r(t,n,e,s,r,l){const i=t.substring(0,s),c=n.substring(0,r),g=t.substring(s),h=n.substring(r),u=o(i,c,e,!1,l),f=o(g,h,e,!1,l);return u.concat(f)}function l(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,s=Math.min(t.length,n.length),o=s,r=0;for(;e<o;)t.substring(r,o)===n.substring(r,o)?(e=o,r=e):s=o,o=Math.floor((s-e)/2+e);return o}function i(t,n){if(!t||!n||t.charAt(t.length-1)!==n.charAt(n.length-1))return 0;let e=0,s=Math.min(t.length,n.length),o=s,r=0;for(;e<o;)t.substring(t.length-o,t.length-r)===n.substring(n.length-o,n.length-r)?(e=o,r=e):s=o,o=Math.floor((s-e)/2+e);return o}function c(t,n){const e=t.length,s=n.length;if(0===e||0===s)return 0;e>s?t=t.substring(e-s):e<s&&(n=n.substring(0,e));const o=Math.min(e,s);if(t===n)return o;let r=0,l=1;for(;;){const e=t.substring(o-l),s=n.indexOf(e);if(-1===s)return r;l+=s,0!==s&&t.substring(o-l)!==n.substring(0,l)||(r=l,l++)}}const g=/[^a-z0-9]/i,h=/\s/,u=/[\r\n]/,f=/\n\r?\n$/,a=/^\r?\n\r?\n/;function p(t){t.push(s(0,""));let n,o=0,r=0,c=0,g="",h="";for(;o<t.length;)switch(t[o][0]){case 1:c++,h+=t[o][1],o++;break;case e:r++,g+=t[o][1],o++;break;case 0:r+c>1?(0!==r&&0!==c&&(n=l(h,g),0!==n&&(o-r-c>0&&0===t[o-r-c-1][0]?t[o-r-c-1][1]+=h.substring(0,n):(t.splice(0,0,s(0,h.substring(0,n))),o++),h=h.substring(n),g=g.substring(n)),n=i(h,g),0!==n&&(t[o][1]=h.substring(h.length-n)+t[o][1],h=h.substring(0,h.length-n),g=g.substring(0,g.length-n))),o-=r+c,t.splice(o,r+c),g.length&&(t.splice(o,0,s(e,g)),o++),h.length&&(t.splice(o,0,s(1,h)),o++),o++):0!==o&&0===t[o-1][0]?(t[o-1][1]+=t[o][1],t.splice(o,1)):o++,c=0,r=0,g="",h=""}""===t[t.length-1][1]&&t.pop();let u=!1;for(o=1;o<t.length-1;)0===t[o-1][0]&&0===t[o+1][0]&&(t[o][1].substring(t[o][1].length-t[o-1][1].length)===t[o-1][1]?(t[o][1]=t[o-1][1]+t[o][1].substring(0,t[o][1].length-t[o-1][1].length),t[o+1][1]=t[o-1][1]+t[o+1][1],t.splice(o-1,1),u=!0):t[o][1].substring(0,t[o+1][1].length)===t[o+1][1]&&(t[o-1][1]+=t[o+1][1],t[o][1]=t[o][1].substring(t[o+1][1].length)+t[o+1][1],t.splice(o+1,1),u=!0)),o++;u&&p(t)}const b=t=>"[33m"+t+"[0m",d=t=>"[2m"+t+"[0m";"undefined"==typeof process&&(window.process={},process.stdout=process.stdout||{},process.stdout.write=function(t){console.log(t)});const m={context_size:40},x={context_size:40,green_color:"#64a166",red_color:"#b54545",yellow_color:"#dbda81"},_={context_size:40,green_color:"#64a166",red_color:"#b54545",yellow_color:"#dbda81"},w=function(t){const n=[];let e=0;for(const[s,o]of t)0!==s&&n.push({op:s,text:o,pos:e}),1!==s&&(e+=o.length);return n};t.diffCli=function(t,n,e){let s=o(t,n);!function(t,n,e={}){const s=Object.assign({},m,e);t.forEach((t,e)=>{let{op:o,text:r,pos:l}=t;console.log(b("\n\n- #"+(e+1)+" ------"));const i=Math.max(0,l-s.context_size),c=n.slice(i,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);process.stdout.write(d(c)),-1===o?process.stdout.write("[31m-"+r+"[0m"):1===o?process.stdout.write("[32m"+("+"+r)+"[0m"):process.stdout.write(b(" "+r)),process.stdout.write(d(g))}),console.log("\n")}(w(s),t,e)},t.diffConsole=function(t,n,e){let s=o(t,n);!function(t,n,e={}){const s=Object.assign({},_,e);t.forEach((t,e)=>{let{op:o,text:r,pos:l}=t;const i=Math.max(0,l-s.context_size),c=n.slice(i,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);-1===o?console.log(c+"%c-"+r,`color: white; background-color: ${s.red_color}; padding: 2px,`,g):1===o?console.log(c+"%c+"+r,`color: white; background-color: ${s.green_color}; padding: 2px;`,g):console.log(c+"%c "+r,`color: white; background-color: ${s.yellow_color}; padding: 2px;`,g)})}(w(s),t,e)},t.diffHtml=function(t,n,e){let s=o(t,n);return function(t,n,e={}){const s=Object.assign({},x,e);let o="";return t.forEach((t,e)=>{let{op:r,text:l,pos:i}=t;const c=Math.max(0,i-s.context_size),g=n.slice(c,i),h=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);o+='<div class="diff-each">',o+=`<span class='diff-before'>${g}</span>\n`,o+=-1===r?`<span class='diff diff-minus' style="color:${s.red_color}">-${l}</span>\n`:1===r?`<span class='diff diff-plus' style="color:${s.green_color}">+${l}</span>\n`:`<span class='diff diff-change' style="color:${s.yellow_color}"> ${l}</span>\n`,o+=`<span class='diff-after'>${h}</span>\n`,o+="</div>"}),'<div class="diff-container">\n'+o+"\n</div>"}(w(s),t,e)}});
