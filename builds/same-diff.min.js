!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).sameDiff={})}(this,function(t){"use strict";const n=Object.freeze({diffTimeout:1,diffEditCost:4,matchThreshold:.5,matchDistance:1e3,patchDeleteThreshold:.5,patchMargin:4,matchMaxBits:32});const e=-1;function s(t,n){return[t,n]}function r(t,b,d,m=!0,x){const w=function(t){if(t?.__resolved)return t;const e={...n,...t};return Object.defineProperty(e,"__resolved",{value:!0,enumerable:!1}),e}(d);void 0===x&&(x=w.diffTimeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*w.diffTimeout);const _=x;if(null==t||null==b)throw new Error("Null input. (diff_main)");if(t===b)return t?[s(0,t)]:[];const A=m;let y=l(t,b);const M=t.substring(0,y);y=i(t=t.substring(y),b=b.substring(y));const O=t.substring(t.length-y),$=function(t,n,b,d,m){let x;if(!t)return[s(1,n)];if(!n)return[s(e,t)];const w=t.length>n.length?t:n,_=t.length>n.length?n:t,A=w.indexOf(_);if(-1!==A)return x=[s(1,w.substring(0,A)),s(0,_),s(1,w.substring(A+_.length))],t.length>n.length&&(x[0][0]=x[2][0]=e),x;if(1===_.length)return[s(e,t),s(1,n)];const y=function(t,n,e){if(e.diffTimeout<=0)return null;const s=t.length>n.length?t:n,r=t.length>n.length?n:t;if(s.length<4||2*r.length<s.length)return null;function o(t,n,e){const s=t.substring(e,e+Math.floor(t.length/4));let r,o,c,g,u=-1,h="";for(;-1!==(u=n.indexOf(s,u+1));){const s=l(t.substring(e),n.substring(u)),f=i(t.substring(0,e),n.substring(0,u));h.length<f+s&&(h=n.substring(u-f,u)+n.substring(u,u+s),r=t.substring(0,e-f),o=t.substring(e+s),c=n.substring(0,u-f),g=n.substring(u+s))}return 2*h.length>=t.length?[r,o,c,g,h]:null}const c=o(s,r,Math.ceil(s.length/4)),g=o(s,r,Math.ceil(s.length/2));let u,h,f,a,p;if(!c&&!g)return null;u=g?c&&c[4].length>g[4].length?c:g:c;t.length>n.length?(h=u[0],f=u[1],a=u[2],p=u[3]):(a=u[0],p=u[1],h=u[2],f=u[3]);const b=u[4];return[h,f,a,p,b]}(t,n,b);if(y){const t=y[0],n=y[1],e=y[2],o=y[3],l=y[4],i=r(t,e,b,d,m),c=r(n,o,b,d,m);return i.concat([s(0,l)],c)}return d&&t.length>100&&n.length>100?function(t,n,o,l){const b=function(t,n){const e=[],s={};let r=4e4;function o(t){let n="",o=0,l=-1,i=e.length;for(;l<t.length-1;){l=t.indexOf("\n",o),-1===l&&(l=t.length-1);let c=t.substring(o,l+1);(s.hasOwnProperty?Object.prototype.hasOwnProperty.call(s,c):void 0!==s[c])?n+=String.fromCharCode(s[c]):(i===r&&(c=t.substring(o),l=t.length),n+=String.fromCharCode(i),s[c]=i,e[i++]=c),o=l+1}return n}e[0]="";const l=o(t);r=65535;const i=o(n);return{chars1:l,chars2:i,lineArray:e}}(t,n);t=b.chars1,n=b.chars2;const d=b.lineArray,m=r(t,n,o,!1,l);(function(t,n){for(let e=0;e<t.length;e++){const s=t[e][1],r=[];for(let t=0;t<s.length;t++)r[t]=n[s.charCodeAt(t)];t[e][1]=r.join("")}})(m,d),function(t){let n=!1;const r=[];let o=0,l=null,b=0,d=0,m=0,x=0,w=0;for(;b<t.length;)0===t[b][0]?(r[o++]=b,d=x,m=w,x=0,w=0,l=t[b][1]):(1===t[b][0]?x+=t[b][1].length:w+=t[b][1].length,l&&l.length<=Math.max(d,m)&&l.length<=Math.max(x,w)&&(t.splice(r[o-1],0,s(e,l)),t[r[o-1]+1][0]=1,o--,o--,b=o>0?r[o-1]:-1,d=0,m=0,x=0,w=0,l=null,n=!0)),b++;n&&p(t);(function(t){function n(t,n){if(!t||!n)return 6;const e=t.charAt(t.length-1),s=n.charAt(0),r=e.match(g),o=s.match(g),l=r&&e.match(u),i=o&&s.match(u),c=l&&e.match(h),p=i&&s.match(h),b=c&&t.match(f),d=p&&n.match(a);return b||d?5:c||p?4:r&&!l&&i?3:l||i?2:r||o?1:0}let e=1;for(;e<t.length-1;){if(0===t[e-1][0]&&0===t[e+1][0]){let s=t[e-1][1],r=t[e][1],o=t[e+1][1];const l=i(s,r);if(l){const t=r.substring(r.length-l);s=s.substring(0,s.length-l),r=t+r.substring(0,r.length-l),o=t+o}let c=s,g=r,u=o,h=n(s,r)+n(r,o);for(;r.charAt(0)===o.charAt(0);){s+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);const t=n(s,r)+n(r,o);t>=h&&(h=t,c=s,g=r,u=o)}t[e-1][1]!==c&&(c?t[e-1][1]=c:(t.splice(e-1,1),e--),t[e][1]=g,u?t[e+1][1]=u:(t.splice(e+1,1),e--))}e++}})(t),b=1;for(;b<t.length;){if(t[b-1][0]===e&&1===t[b][0]){const n=t[b-1][1],r=t[b][1],o=c(n,r),l=c(r,n);o>=l?(o>=n.length/2||o>=r.length/2)&&(t.splice(b,0,s(0,r.substring(0,o))),t[b-1][1]=n.substring(0,n.length-o),t[b+1][1]=r.substring(o),b++):(l>=n.length/2||l>=r.length/2)&&(t.splice(b,0,s(0,n.substring(0,l))),t[b-1][0]=1,t[b-1][1]=r.substring(0,r.length-l),t[b+1][0]=e,t[b+1][1]=n.substring(l),b++),b++}b++}}(m),m.push(s(0,""));let x=0,w=0,_=0,A="",y="";for(;x<m.length;){switch(m[x][0]){case 1:_++,y+=m[x][1];break;case e:w++,A+=m[x][1];break;case 0:if(w>=1&&_>=1){m.splice(x-w-_,w+_),x=x-w-_;const t=r(A,y,o,!1,l);for(let n=t.length-1;n>=0;n--)m.splice(x,0,t[n]);x+=t.length}_=0,w=0,A="",y=""}x++}return m.pop(),m}(t,n,b,m):function(t,n,r,l){const i=t.length,c=n.length,g=Math.ceil((i+c)/2),u=g,h=2*g,f=new Array(h),a=new Array(h);for(let t=0;t<h;t++)f[t]=-1,a[t]=-1;f[u+1]=0,a[u+1]=0;const p=i-c,b=p%2!=0;let d=0,m=0,x=0,w=0;for(let e=0;e<g&&!((new Date).getTime()>l);e++){for(let s=-e+d;s<=e-m;s+=2){const g=u+s;let x;x=s===-e||s!==e&&f[g-1]<f[g+1]?f[g+1]:f[g-1]+1;let w=x-s;for(;x<i&&w<c&&t.charAt(x)===n.charAt(w);)x++,w++;if(f[g]=x,x>i)m+=2;else if(w>c)d+=2;else if(b){const e=u+p-s;if(e>=0&&e<h&&-1!==a[e]){if(x>=i-a[e])return o(t,n,r,x,w,l)}}}for(let s=-e+x;s<=e-w;s+=2){const g=u+s;let d;d=s===-e||s!==e&&a[g-1]<a[g+1]?a[g+1]:a[g-1]+1;let m=d-s;for(;d<i&&m<c&&t.charAt(i-d-1)===n.charAt(c-m-1);)d++,m++;if(a[g]=d,d>i)w+=2;else if(m>c)x+=2;else if(!b){const e=u+p-s;if(e>=0&&e<h&&-1!==f[e]){const s=f[e];if(d=i-d,s>=d)return o(t,n,r,s,u+s-e,l)}}}}return[s(e,t),s(1,n)]}(t,n,b,m)}(t=t.substring(0,t.length-y),b=b.substring(0,b.length-y),w,A,_);return M&&$.unshift(s(0,M)),O&&$.push(s(0,O)),p($),$}function o(t,n,e,s,o,l){const i=t.substring(0,s),c=n.substring(0,o),g=t.substring(s),u=n.substring(o),h=r(i,c,e,!1,l),f=r(g,u,e,!1,l);return h.concat(f)}function l(t,n){if(!t||!n||t.charAt(0)!==n.charAt(0))return 0;let e=0,s=Math.min(t.length,n.length),r=s,o=0;for(;e<r;)t.substring(o,r)===n.substring(o,r)?(e=r,o=e):s=r,r=Math.floor((s-e)/2+e);return r}function i(t,n){if(!t||!n||t.charAt(t.length-1)!==n.charAt(n.length-1))return 0;let e=0,s=Math.min(t.length,n.length),r=s,o=0;for(;e<r;)t.substring(t.length-r,t.length-o)===n.substring(n.length-r,n.length-o)?(e=r,o=e):s=r,r=Math.floor((s-e)/2+e);return r}function c(t,n){const e=t.length,s=n.length;if(0===e||0===s)return 0;e>s?t=t.substring(e-s):e<s&&(n=n.substring(0,e));const r=Math.min(e,s);if(t===n)return r;let o=0,l=1;for(;;){const e=t.substring(r-l),s=n.indexOf(e);if(-1===s)return o;l+=s,0!==s&&t.substring(r-l)!==n.substring(0,l)||(o=l,l++)}}const g=/[^a-z0-9]/i,u=/\s/,h=/[\r\n]/,f=/\n\r?\n$/,a=/^\r?\n\r?\n/;function p(t){t.push(s(0,""));let n,r=0,o=0,c=0,g="",u="";for(;r<t.length;)switch(t[r][0]){case 1:c++,u+=t[r][1],r++;break;case e:o++,g+=t[r][1],r++;break;case 0:o+c>1?(0!==o&&0!==c&&(n=l(u,g),0!==n&&(r-o-c>0&&0===t[r-o-c-1][0]?t[r-o-c-1][1]+=u.substring(0,n):(t.splice(0,0,s(0,u.substring(0,n))),r++),u=u.substring(n),g=g.substring(n)),n=i(u,g),0!==n&&(t[r][1]=u.substring(u.length-n)+t[r][1],u=u.substring(0,u.length-n),g=g.substring(0,g.length-n))),r-=o+c,t.splice(r,o+c),g.length&&(t.splice(r,0,s(e,g)),r++),u.length&&(t.splice(r,0,s(1,u)),r++),r++):0!==r&&0===t[r-1][0]?(t[r-1][1]+=t[r][1],t.splice(r,1)):r++,c=0,o=0,g="",u=""}""===t[t.length-1][1]&&t.pop();let h=!1;for(r=1;r<t.length-1;)0===t[r-1][0]&&0===t[r+1][0]&&(t[r][1].substring(t[r][1].length-t[r-1][1].length)===t[r-1][1]?(t[r][1]=t[r-1][1]+t[r][1].substring(0,t[r][1].length-t[r-1][1].length),t[r+1][1]=t[r-1][1]+t[r+1][1],t.splice(r-1,1),h=!0):t[r][1].substring(0,t[r+1][1].length)===t[r+1][1]&&(t[r-1][1]+=t[r+1][1],t[r][1]=t[r][1].substring(t[r+1][1].length)+t[r+1][1],t.splice(r+1,1),h=!0)),r++;h&&p(t)}const b=t=>"[2m"+t+"[0m";"undefined"==typeof process&&(window.process={},process.stdout=process.stdout||{},process.stdout.write=function(t){console.log(t)});const d={context_size:40},m={context_size:40,green_color:"#64a166",red_color:"#b54545",yellow_color:"#dbda81"},x={context_size:40,green_color:"#64a166",red_color:"#b54545",yellow_color:"#dbda81"},w=function(t){const n=[];let e=0;for(const[s,r]of t)0!==s&&n.push({op:s,text:r,pos:e}),1!==s&&(e+=r.length);return n};t.diffCli=function(t,n,e){let s=r(t,n);!function(t,n,e={}){const s=Object.assign({},d,e);t.forEach((t,e)=>{let{op:r,text:o,pos:l}=t;process.stdout.write("\n");const i=Math.max(0,l-s.context_size),c=n.slice(i,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);process.stdout.write(b(c)),-1===r?process.stdout.write("[31m-"+o+"[0m"):1===r?process.stdout.write("[32m"+("+"+o)+"[0m"):process.stdout.write((t=>"[33m"+t+"[0m")(" "+o)),process.stdout.write(b(g))}),process.stdout.write("\n\n\n")}(w(s),t,e)},t.diffConsole=function(t,n,e){let s=r(t,n);!function(t,n,e={}){const s=Object.assign({},x,e);t.forEach((t,e)=>{let{op:r,text:o,pos:l}=t;const i=Math.max(0,l-s.context_size),c=n.slice(i,l),g=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);-1===r?console.log(c+"%c-"+o,`color: white; background-color: ${s.red_color}; padding: 2px,`,g):1===r?console.log(c+"%c+"+o,`color: white; background-color: ${s.green_color}; padding: 2px;`,g):console.log(c+"%c "+o,`color: white; background-color: ${s.yellow_color}; padding: 2px;`,g)})}(w(s),t,e)},t.diffHtml=function(t,n,e){let s=r(t,n);return function(t,n,e={}){const s=Object.assign({},m,e);let r="";return t.forEach((t,e)=>{let{op:o,text:l,pos:i}=t;const c=Math.max(0,i-s.context_size),g=n.slice(c,i),u=n.slice(t.pos+(-1===t.op?t.text.length:0),t.pos+s.context_size);r+='<div class="diff-each">',r+=`<span class='diff-before'>${g}</span>\n`,r+=-1===o?`<span class='diff diff-minus' style="color:${s.red_color}">-${l}</span>\n`:1===o?`<span class='diff diff-plus' style="color:${s.green_color}">+${l}</span>\n`:`<span class='diff diff-change' style="color:${s.yellow_color}"> ${l}</span>\n`,r+=`<span class='diff-after'>${u}</span>\n`,r+="</div>"}),'<div class="diff-container">\n'+r+"\n</div>"}(w(s),t,e)}});
